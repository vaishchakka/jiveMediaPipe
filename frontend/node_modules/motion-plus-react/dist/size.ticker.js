import{jsx as e,jsxs as t}from"react/jsx-runtime";import{useTransform as n,motion as i,isHTMLElement as r,wrap as o,frame as a,useMotionValue as s,useInView as d,useReducedMotion as c,useIsomorphicLayoutEffect as l,resize as f,useAnimationFrame as u,noop as m,animate as g}from"motion/react";import{createContext as x,useRef as S,useEffect as p,useState as v,useMemo as h}from"react";const w=x(void 0);function y({offset:t,axis:r,listSize:o=0,itemIndex:a,cloneIndex:s,bounds:d,containerPaddingStart:c,...l}){const f=S(null),{start:u,end:m}=d,g=n((()=>{const e=t.get();return(u||m)&&o&&e+m<=-c?o:0})),x=n((()=>{const e=t.get(),n=g.get();return(u||m)&&o?e+u+n:0}));return e(w.Provider,{value:{offset:x},children:e(i.li,{ref:f,...l,className:void 0===s?"ticker-item":"clone-item",style:{flexShrink:0,flexGrow:0,x:"x"===r?g:0,y:"y"===r?g:0},"aria-hidden":void 0!==s||void 0})})}function z(e,t,n,i,s){const d=S(!1);p((()=>{const c=e.current;if(!c)return;let l=!1;const f=new AbortController,u={signal:f.signal},m={...u,capture:!0},g="x"===t?"scrollLeft":"scrollTop",x="x"===t?"offsetLeft":"offsetTop",S="x"===t?"ArrowLeft":"ArrowUp",p="x"===t?"ArrowRight":"ArrowDown";let v=[],h=0;const w=()=>{const e=v[h];e.focus(),n.set(-e[x]),c[g]=0,a.render((()=>{c[g]=0}))},y=e=>{if("Tab"!==e.key)e.key===S?h--:e.key===p&&h++,h=o(0,v.length,h),w();else{e.preventDefault(),L();const t=Array.from(document.querySelectorAll('a, button, input, textarea, select, [tabindex]:not([tabindex="-1"]), [contenteditable="true"]')).filter(r);t.sort(b);const n=t[e.shiftKey?0:t.length-1],i=e.shiftKey?t.length-1:0;if(c.contains(n))return void t[i].focus();{const n=t.indexOf(v[h]),i=e.shiftKey?-1:1;for(let e=n;e<t.length&&e>=0;e+=i){const n=t[e];if(!c.contains(n))return void n.focus()}}}},z=e=>{e.target&&e.target instanceof HTMLElement&&c.contains(e.target)||L()},L=()=>{d.current&&(d.current=!1,s(!1),i.set(n.get()),window.removeEventListener("focus",z),window.removeEventListener("blur",z),c.removeEventListener("keydown",y))},P=e=>{const{target:t}=e;r(t)&&(d.current||d.current||(s(!0),d.current=!0,v=Array.from(c.querySelectorAll('.ticker-item a, .ticker-item button, .ticker-item input, .ticker-item textarea, .ticker-item select, .ticker-item [tabindex]:not([tabindex="-1"]), .ticker-item [contenteditable="true"]')).filter(r),h=0,w(),window.addEventListener("focus",z,m),window.addEventListener("blur",z,m),c.addEventListener("keydown",y,u)))},I=()=>{l&&(l=!1,c.removeEventListener("focus",P,!0),window.removeEventListener("pointermove",I,u))};return window.addEventListener("keydown",(()=>{l||(l=!0,c.addEventListener("focus",P,m),window.addEventListener("pointermove",I,u))}),u),c.addEventListener("pointerdown",(e=>{let t=e.target.closest('[aria-hidden="true"]');t&&t.removeAttribute("aria-hidden")}),u),()=>{f.abort(),L()}}),[])}function b(e,t){return e.tabIndex>=1&&t.tabIndex>=1?e.tabIndex-t.tabIndex:e.tabIndex>=1&&t.tabIndex<=0?-1:t.tabIndex>=1&&e.tabIndex<=0?1:0}function L({items:t,velocity:i=50,hoverFactor:r=1,gap:a=10,axis:x="x",align:p="center",offset:w,isStatic:b=!1,...L}){const[E,k]=v({listSize:0,containerSize:0,containerPaddingStart:0,containerPaddingEnd:0,itemSizes:[]}),A="start"===p?"flex-start":"center"===p?"center":"flex-end";if(b){const n=s(0);return e(P,{containerProps:L,gap:a,axis:x,alignItems:A,renderedOffset:n,items:t,state:E,isStatic:!0})}const[T,M]=v(!1),R=s(1),C=s(0);w??(w=C);const O=n((()=>o(-E.listSize-a-E.containerPaddingStart,-E.containerPaddingStart,w.get()))),q=s(0),D=T?q:O,H=S(null),K=S(null),$=d(H,{margin:"100px"}),j=c(),W=()=>{if(!H.current||!K.current)return;const e="x"===x?"innerWidth":"innerHeight",t="x"===x?"offsetWidth":"offsetHeight",n="x"===x?"offsetLeft":"offsetTop",i="x"===x?"paddingLeft":"paddingTop",r="x"===x?"paddingRight":"paddingBottom",o=H.current,a=K.current.querySelectorAll(".ticker-item");if(!a.length)return;let s=!1;const d=[];for(let e=0;e<a.length;e++){const i=a[e];d.push({start:i[n],end:i[n]+i[t]}),E.itemSizes[e]&&d[e].start===E.itemSizes[e].start&&d[e].end===E.itemSizes[e].end||(s=!0)}const c=Math.min(o[t],window[e]),l=d[d.length-1].end-d[0].start,f=window.getComputedStyle(o),u=parseInt(f[i]??0),m=parseInt(f[r]??0);(l!==E.listSize||c!==E.containerSize||s)&&k({listSize:l,containerSize:c,containerPaddingStart:u,containerPaddingEnd:m,itemSizes:d})};l((()=>{if($&&H.current)return W(),f(H.current,W)}),[t,$]);const B=E.containerSize>0&&E.listSize>0;u(B&&$&&w===C&&!j?(e,t)=>{const n=t/1e3*(i*R.get());w.set(w.get()-n)}:m);const F=h((()=>{let e=0;if(!B||!E.containerSize)return 0;let t=0;const n=Math.max(...E.itemSizes.map((e=>e.end-e.start)));for(;t<E.containerSize+E.containerPaddingStart;)t=(E.listSize+a)*(e+1)-n,e++;return Math.max(e-1,0)}),[B,E.containerSize,E.listSize]),G=0===E.listSize?0:(E.listSize+a)*(F+1),N=[];for(let n=0;n<F;n++)t.forEach(((t,i)=>{const r=E.itemSizes[i],o=(E.listSize+a)*(n+1),s=r?{start:r.start+o,end:r.end+o}:I;N.push(e(y,{offset:D,axis:x,listSize:G,cloneIndex:i,bounds:s,containerPaddingStart:E.containerPaddingStart,children:t},`clone-${n}-${i}`))}));return z(H,x,q,w,M),e(P,{containerProps:L,containerRef:H,listRef:K,gap:a,axis:x,alignItems:A,isMeasured:B,renderedOffset:D,items:t,clonedItems:N,onPointerEnter:()=>{g(R,r)},onPointerLeave:()=>{g(R,1)},totalListSize:G,state:E})}function P({containerProps:n,containerRef:r,listRef:o,gap:a,axis:s,alignItems:d,isMeasured:c,isStatic:l,items:f,clonedItems:u,renderedOffset:m,onPointerEnter:g,onPointerLeave:x,totalListSize:S,state:p}){return e(i.div,{...n,ref:r,style:{...E,...n.style},onPointerEnter:g,onPointerLeave:x,children:t(i.ul,{ref:o,style:{...k,flexDirection:"x"===s?"row":"column",gap:`${a}px`,alignItems:d,x:"x"===s?m:0,y:"y"===s?m:0,opacity:c||l?1:0},children:[f.map(((t,n)=>e(y,{axis:s,offset:m,listSize:S,itemIndex:n,bounds:p.itemSizes[n]??I,containerPaddingStart:p.containerPaddingStart,children:t},"original-"+n))),u||null]})})}const I={start:0,end:0},E={display:"flex",position:"relative",overflow:"hidden"},k={display:"flex",position:"relative",willChange:"transform",listStyleType:"none",padding:0,margin:0,justifyContent:"flex-start"};export{L as Ticker};
