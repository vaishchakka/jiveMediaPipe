import{jsx as t}from"react/jsx-runtime";import{pipe as e,useTransform as n,motionValue as o,frame as i,mix as r,useSpring as s,useMotionValue as a,useIsomorphicLayoutEffect as u,animate as d,useReducedMotion as c,LayoutGroup as l,MotionConfig as p,motion as f,AnimatePresence as g}from"motion/react";import{useState as m,useLayoutEffect as h,useEffect as x,useInsertionEffect as y,useRef as w}from"react";import{createPortal as v}from"react-dom";import{noop as B}from"motion-utils";function z(t,e,n){return{width:n?.width??t,height:n?.height??e}}let S=null;function E(){const t=new Set;function e(){t.forEach((t=>t.show()))}function n(){t.forEach((t=>t.hide()))}return{on:o=>(t.size||(document.body.addEventListener("mouseenter",e),document.body.addEventListener("mouseleave",n)),t.add(o),()=>{t.delete(o),0===t.size&&(document.body.removeEventListener("mouseenter",e),document.body.removeEventListener("mouseleave",n))})}}function b(t){const[e,n]=m(!0);return x((()=>(S||(S=E()),S).on({show:()=>{e||(t(),n(!0))},hide:()=>n(!1)})),[e]),e}function L(t){return e=>{"mouse"===e.pointerType&&t(e)}}function C(t){return L((e=>{0===e.button&&t(e)}))}function P(t){let e=function(t){return t.closest("[data-cursor]")}(t);return e?[e.dataset.cursor,e]:(e=t.closest('a, button, input[type="button"]:not(:disabled)'),e?["pointer",e]:(e=function(t){return"none"===window.getComputedStyle(t).userSelect?null:t.closest("p, textarea:not(:disabled), input[type='text']:not(:disabled), h1, h2, h3, h4, h5, h6")}(t),e?["text",e]:["default",null]))}let T,j,O=null,M={type:"default",isPressed:!1,fontSize:null,targetBoundingBox:null,target:null,zone:null};function $(t){let e=null;if("closest"in t){const n=t.closest("[data-cursor-zone]");n instanceof HTMLElement&&(e=n.dataset.cursorZone||null)}return e}function I(){const t=new Set;function e(e){M={...M,...e},t.forEach((t=>t(M)))}const n=C((()=>{M.isPressed||e({isPressed:!0})})),o=C((()=>{M.isPressed&&e({isPressed:!1})})),i=L((({target:t})=>{if(!t)return;const[n,o]=P(t);let i=!1,r={target:o,zone:$(t)};n!==M.type&&(r.type=n,i=!0),r.zone!==M.zone&&(r.zone=r.zone,i=!0);const s="pointer"===n&&o?o.getBoundingClientRect():null;if(s!==M.targetBoundingBox&&(r.targetBoundingBox=s,i=!0),"text"===n){const{fontSize:e}=window.getComputedStyle(t),n=e?parseInt(e):null;n!==M.fontSize&&(r.fontSize=n,i=!0)}else M.fontSize&&(r.fontSize=null,i=!0);i&&e(r)}));return{onChange:e=>(t.size||(window.addEventListener("pointerover",i),window.addEventListener("pointerdown",n),window.addEventListener("pointerup",o)),t.add(e),()=>{t.delete(e),t.size||(window.removeEventListener("pointerover",i),window.removeEventListener("pointerdown",n),window.removeEventListener("pointerup",o))})}}function R(){const[t,e]=m({...M});return x((()=>(O||(O=I()),O).onChange((t=>{e(t)}))),[t]),t}function X(){return T||function(){T=o(0),j=o(0);let t=0,e=0;function n(){T.set(t),j.set(e)}"undefined"!=typeof window&&window.addEventListener("pointermove",L((o=>{t=o.clientX,e=o.clientY,i.update(n)})))}(),{x:T,y:j}}function Y(t,e,o){const i=s(0,{stiffness:600,damping:50}),c=a(0),l=(p=t,f=i,g=c,n((()=>r(p.get(),f.get(),g.get()))));var p,f,g;const m=w(o);return u((()=>{o?(m.current||c.isAnimating()?i.set(o):i.jump(o),d(c,e)):d(c,0),m.current=o}),[o]),l}function k(){const t=document.createElement("style");return t.textContent='\n      * {\n          cursor: none !important;\n      }\n          \n      [data-motion-cursor="pointer"] {\n          background-color: #333;\n      }\n    ',document.head.appendChild(t),()=>{document.head.removeChild(t)}}const A={x:0,y:0},H={x:.5,y:.5},Z={duration:0},q={followSpring:{stiffness:1e3,damping:100},magneticOptions:{morph:!0,padding:5,snap:.8}};function D({follow:o=!1,center:i=(o?A:H),offset:r=A,spring:a=!!o&&q.followSpring,magnetic:u=!1,matchTextSize:d=!0,children:x,style:w,...S}){const E=c();var L;y((L=!E&&!o)?k:B,[L]);const C=X(),P=function(t,e){return{x:n((()=>t.x.get()+e.x)),y:n((()=>t.y.get()+e.y))}}(C,r),T=s(P.x,a||void 0),j=s(P.y,a||void 0),O="object"==typeof u?{...q.magneticOptions,...u}:q.magneticOptions,M=()=>{const t=P.x.on("change",(e=>{T.jump(e),t()})),e=P.y.on("change",(t=>{j.jump(t),e()}))},$=R(),I=b(M),{x:D,y:G}=function(t,e,n,o){const i=Y(t.x,o,n.targetBoundingBox?n.targetBoundingBox.left+n.targetBoundingBox.width/2:void 0),r=Y(t.y,o,n.targetBoundingBox?n.targetBoundingBox.top+n.targetBoundingBox.height/2:void 0);return e?{x:i,y:r}:t}(a?{x:T,y:j}:C,Boolean(u),$,O.snap),{width:J,height:K}=function({type:t,state:e,hasChildren:n,style:o,isMagnetic:i,magneticOptions:r,matchTextSize:s}){const a=i&&e.targetBoundingBox;if(n&&!a)return z("auto","auto",o);switch(t){case"pointer":const{padding:t,morph:n}=r;if(i&&n&&e.targetBoundingBox){const{width:n,height:o}=e.targetBoundingBox;return{width:n+2*t,height:o+2*t}}return z(31,31,o);case"text":return s&&e.fontSize?{width:4,height:e.fontSize}:z(4,20,o);default:return z(17,17,o)}}({type:$.type,state:$,hasChildren:Boolean(x),style:w,isMagnetic:Boolean(u),magneticOptions:O,matchTextSize:d}),N=function({x:t,y:n},o){const[i,r]=m(void 0!==t.prev||void 0!==n.prev);return y((()=>{if(i)return;const s=()=>{r(!0),o(),a()},a=e(t.on("change",s),n.on("change",s));return()=>a()}),[t,n,i]),i}(C,M);return function(t){const[e,n]=m(null);return h((()=>{n(document.body)}),[]),e?v(t,e):null}(N?t(l,{children:t(p,{transition:E?Z:S.transition||F,children:t(f.div,{layout:!0,"data-motion-cursor":o?"follow":"pointer","data-framer-portal-id":"motion-cursor",initial:"exit",exit:"exit",...S,variants:{pressed:o?{}:{scale:.9},...S.variants,default:{opacity:1,scale:1,...S.variants?.default},exit:{opacity:0,scale:0,...S.variants?.exit}},animate:["default",$.type,u&&$.targetBoundingBox?"magnetic":"",I?$.isPressed?"pressed":"":"exit"],transformTemplate:(Q=i,(t,e)=>`translate(-${100*Q.x}%, -${100*Q.y}%) ${e}`),style:{borderRadius:o?0:20,zIndex:o?99998:99999,willChange:"transform",contain:"layout",originX:i.x,originY:i.y,...w,width:J,height:K,x:D,y:G,top:0,left:0,position:"fixed",pointerEvents:"none"},children:t(g,{children:x})})})}):null);var Q}const F={duration:.15,ease:[.38,.12,.29,1]};export{D as Cursor};
